---
title: 死锁
subject: 专业课843
chapter: 操作系统
status: 未开始
created: 2026-02-27
tags: [知识点, 843, 操作系统, 死锁]
---

# 死锁 ⭐⭐⭐⭐

---

## 死锁的定义

多个进程因**循环等待资源**而永久阻塞的状态。

**例：**
- 进程A持有资源1，等待资源2
- 进程B持有资源2，等待资源1
- → 两者永久等待 = 死锁

---

## 死锁的四个必要条件

**四个条件同时满足才会死锁，破坏任意一个即可预防：**

| 条件 | 含义 | 如何破坏 |
|------|------|---------|
| **互斥**（Mutual Exclusion）| 资源一次只能被一个进程使用 | 使用可共享资源（如只读文件）|
| **请求与保持**（Hold & Wait）| 进程持有资源的同时请求新资源 | 一次性申请所有资源 |
| **不可剥夺**（No Preemption）| 已分配的资源不能强制回收 | 允许OS强制剥夺资源 |
| **循环等待**（Circular Wait）| 进程间形成等待环 | 对资源编号，按序申请 |

> 记忆口诀：**互请不循**

---

## 死锁处理策略

### 1. 死锁预防（静态）

破坏四个条件之一：

- **破坏请求与保持**：进程开始前一次申请全部资源
  - 缺点：资源利用率低，可能造成饥饿
- **破坏循环等待**：资源全局编号，只能按升序申请
  - 实用，常用于操作系统设计

### 2. 死锁避免（动态）——银行家算法 ⭐

**核心思想**：系统在分配资源前，判断分配后是否仍处于**安全状态**。

**安全状态**：存在一个进程执行序列（安全序列），使每个进程都能获得所需资源并完成。

#### 银行家算法数据结构

```
n = 进程数，m = 资源类型数

Available[m]     各类资源当前可用数量
Max[n][m]        每个进程最大需求量
Allocation[n][m] 已分配给每个进程的资源量
Need[n][m]       还需要的资源量 = Max - Allocation
```

#### 安全性检测步骤

```
1. Work = Available（初始化工作向量）
   Finish[i] = false（所有进程未完成）

2. 找一个进程i满足：
   Finish[i] == false 且 Need[i] ≤ Work

3. 若找到：
   Work = Work + Allocation[i]  （进程完成，归还资源）
   Finish[i] = true
   回到步骤2

4. 若所有Finish[i] = true → 安全状态
   否则 → 不安全状态（拒绝分配）
```

#### 例题（背会这个格式）

| 进程 | Max | Allocation | Need | Available |
|------|-----|------------|------|-----------|
| P0 | 7 5 3 | 0 1 0 | 7 4 3 | 3 3 2 |
| P1 | 3 2 2 | 2 0 0 | 1 2 2 | |
| P2 | 9 0 2 | 3 0 2 | 6 0 0 | |
| P3 | 2 2 2 | 2 1 1 | 0 1 1 | |
| P4 | 4 3 3 | 0 0 2 | 4 3 1 | |

**安全序列**：P1 → P3 → P4 → P2 → P0（验证每步 Need ≤ Work）

### 3. 死锁检测与恢复

**检测**：资源分配图（Resource Allocation Graph）
- 圆形 = 进程，方形 = 资源
- 有向边：进程→资源（请求），资源→进程（分配）
- 若图中**无环** → 无死锁
- 若图中**有环** → 可能死锁（每类资源只有1个实例则必然死锁）

**恢复**：
1. 终止所有死锁进程（代价大）
2. 逐一终止进程直到解除死锁（按优先级/代价选择）
3. 剥夺资源（回滚进程到某个检查点）

---

## 死锁 vs 饥饿

| 区别 | 死锁 | 饥饿 |
|------|------|------|
| 原因 | 循环等待 | 资源分配不公平 |
| 能否结束 | 无法自行结束 | 可能某时刻被调度 |
| 解决 | 预防/避免/检测 | 老化机制（提高等待久的进程优先级）|

---

## 高频考点速记

| 考点 | 答案 |
|------|------|
| 死锁必要条件有几个？ | **4个**（互请不循）|
| 破坏哪个条件最实用？ | **循环等待**（资源编号按序申请）|
| 银行家算法属于哪种策略？ | **死锁避免**（非预防，非检测）|
| 安全状态一定无死锁吗？ | ✅ 是 |
| 无死锁一定是安全状态吗？ | ❌ 否（可能不安全但未死锁）|

---

## 相关链接

- [[02-科目/专业课/知识点/技术/操作系统/01-操作系统基础|操作系统基础（总览）]]
- [[02-科目/专业课/知识点/技术/操作系统/02-进程管理|进程管理]]
- [[02-科目/专业课/知识点/技术/操作系统/03-内存管理|内存管理]]
- [[02-科目/专业课/错题/错题汇总|错题汇总]]
