---
subject: 专业课843
chapter: 计算机网络
mastery: 0
next-review: 2026-03-05
status: 未开始
created: 2026-02-27
---

# 02 — 数据链路层

> 导航：[[02-科目/专业课/知识点/技术/计算机网络/00-网络MOC|网络MOC]] | 上：[[02-科目/专业课/知识点/技术/计算机网络/01-物理层|01-物理层]] | 下：[[02-科目/专业课/知识点/技术/计算机网络/03-网络层|03-网络层]]

---

## 一、数据链路层功能

| 功能 | 说明 |
|------|------|
| **封装成帧** | 在数据前后添加帧头和帧尾，标识帧的边界 |
| **透明传输** | 帧中数据可以是任意二进制，通过字节填充/位填充解决帧定界歧义 |
| **差错检测** | 发送方附加校验码，接收方验证，检测（不一定纠正）传输错误 |
| **可靠传输** | ARQ 协议（停等/GBN/SR）保证帧的可靠交付（非所有链路都需要） |
| **流量控制** | 控制发送速率，防止接收方缓冲区溢出 |

---

## 二、差错检测（★★）

### 奇偶校验

- **原理**：在数据后加1位校验位，使整体1的个数为偶数（偶校验）或奇数（奇校验）
- **能力**：仅能检测**奇数个**比特错误，**不能纠错**
- **局限**：2位错误无法检出（误检率高）

### CRC 循环冗余校验（重点）

**原理**：

1. 发送方：在数据后添加 r 位（FCS，帧校验序列），使"数据+FCS"能被生成多项式 G(x) 整除
2. 接收方：将收到的帧除以 G(x)，余数为 0 则认为无误，否则有错

**手算步骤（模2除法，即异或运算，无进位/借位）**：

```
数据：1101  生成多项式：1011（即 x³+x+1）
步骤：
1. 数据后补 r=3 个0：1101 000
2. 用1011对 1101000 做模2除法：
   1101000
   1011
   --------
    110000   （异或后高位为0，商1）
    ...（继续除）
3. 最终余数即 FCS，附在数据后发送
4. 接收方将完整帧（含FCS）除以1011，余数=0则正确
```

- CRC 可以检测所有**单位错**、所有**奇数个错**、所有**长度 ≤ r 的突发错**
- CRC **不能纠错**（数据链路层标准中只用于检错，重传纠错由ARQ保证）

### 海明码

- **能力**：可检测 2 位错，可纠正 1 位错
- **原理**：在数据中插入冗余校验位，每个校验位负责覆盖特定数据位
- **校验位数**：n位数据需要 r 位校验位，满足 $2^r \geq n + r + 1$
- 408 一般只考概念，不考海明码手算

---

## 三、流量控制与可靠传输（★★★）

### 停等协议 (Stop-and-Wait)

- 每发一帧，等待 ACK 后才发下一帧
- **信道利用率**：

$$U = \frac{T_f}{T_f + RTT + T_a}$$

其中 $T_f$ = 帧发送时间，RTT = 往返传播时延，$T_a$ = 确认处理时间

- 问题：当 $T_f \ll RTT$ 时利用率极低（如卫星链路）

### 滑动窗口协议

**核心概念**：

- **发送窗口**：发送方允许连续发送而无需等待 ACK 的帧数
- **接收窗口**：接收方能接收和缓存的帧数范围
- 序号位数 n 位，序号范围 $0$ 到 $2^n - 1$

### GBN（Go-Back-N，回退N帧）

| 参数 | 值 |
|------|----|
| 接收窗口大小 | **1**（只接收按序到达的帧） |
| 发送窗口大小上限 | $2^n - 1$ |
| 出错处理 | 丢弃出错帧及其后所有帧，从出错帧开始**重传所有** |
| 优点 | 接收方简单（无需缓存失序帧） |
| 缺点 | 出错时重传大量已正确帧，带宽浪费 |

### SR（Selective Repeat，选择重传）

| 参数 | 值 |
|------|----|
| 接收窗口大小 | $2^{n-1}$（必须 ≥ 1） |
| 发送窗口大小上限 | $2^{n-1}$ |
| 出错处理 | 只重传出错的特定帧，接收方缓存失序帧 |
| 优点 | 效率高，只重传必要的帧 |
| 缺点 | 接收方需要较大缓冲区和复杂逻辑 |

### 窗口大小与信道利用率关系

设 $a = \frac{传播时延}{帧发送时间}$，则：

$$U = \begin{cases} 1 & \text{若发送窗口} W \geq 2a+1 \\ \frac{W}{2a+1} & \text{若发送窗口} W < 2a+1 \end{cases}$$

---

## 四、CSMA/CD（以太网）（★★★）

### 基本原理

**载波监听多路访问/碰撞检测** (Carrier Sense Multiple Access with Collision Detection)

工作流程：
1. **先听后发**：发送前监听信道，空闲才发送
2. **边发边听**：发送过程中同时检测是否发生碰撞
3. **碰撞停止**：检测到碰撞，立即停止发送，发送**32位强化碰撞信号（jam信号）**
4. **随机退避**：等待随机时间后重新尝试

### 最小帧长（关键公式）

**碰撞检测条件**：发送方在帧发送完毕之前必须检测到碰撞，因此：

$$\text{帧发送时间} \geq 2\tau \quad (\tau = \text{最大单向传播时延})$$

$$\text{最小帧长} = 2\tau \times \text{数据率}$$

**以太网标准（10Mbps, 100m段, 最大网段2500m）**：

$$\text{最小帧长} = 2 \times 25.6\mu s \times 10Mbps = 512 \text{ bits} = 64 \text{ 字节}$$

> 若收到帧长 < 64字节 → 碰撞片（runt frame），直接丢弃

### 截断二进制指数退避算法

第 $k$ 次碰撞后，从 $\{0, 1, 2, \ldots, 2^{\min(k,10)}-1\}$ 中随机选一个整数 $r$，等待 $r \times 51.2\mu s$ 后重传。最多重传 **16次**后放弃并报错。

### 以太网帧格式（DIX Ethernet II）

```
┌────────────┬──────────┬────────┬─────────────┬─────┐
│ 目的MAC(6B)│ 源MAC(6B)│类型(2B)│  数据(46~1500B) │FCS(4B)│
└────────────┴──────────┴────────┴─────────────┴─────┘
```

- 最小帧长 **64字节**（不含前导码）= 6+6+2+46+4
- 最大帧长 **1518字节** = 6+6+2+1500+4
- 前导码（8字节）用于同步，不算在帧长内

---

## 五、PPP 协议

**点对点协议（Point-to-Point Protocol）**，用于拨号连接、广域网点对点链路（如DSL）。

### 帧格式

```
┌────────┬──────┬──────┬────────┬────────────────┬─────┬────────┐
│标志(1B)│地址(1B)│控制(1B)│协议(2B)│信息（变长）│FCS(2B)│标志(1B)│
│  7E    │  FF  │  03  │        │                │     │  7E    │
└────────┴──────┴──────┴────────┴────────────────┴─────┴────────┘
```

- **字节填充**：数据中出现 7E 时替换为 7D 5E，出现 7D 时替换为 7D 5D（转义）
- 特点：**无编号**（不编序号）、**不可靠**（不重传，上层处理）、有差错检测

---

## 六、MAC 地址与 ARP

### MAC 地址

- **长度**：48位（6字节），通常用十六进制表示，如 `00:1A:2B:3C:4D:5E`
- **前24位（OUI）**：厂商标识，由 IEEE 分配
- **后24位**：厂商分配的设备序号
- **广播地址**：`FF:FF:FF:FF:FF:FF`（所有位全1）
- 物理地址，固化在网卡 ROM 中（可软件修改）

### ARP 协议（地址解析协议）

**功能**：将 IP 地址解析为 MAC 地址（网络层 → 数据链路层）

**工作流程**：

1. 主机 A 要给 IP 地址 B 发帧，查本地 ARP 缓存
2. 未找到 → 广播 ARP 请求（含目标IP，目的MAC=FF:FF:FF:FF:FF:FF）
3. 目标主机 B 收到 → 单播 ARP 响应（含自己的MAC）
4. A 收到响应 → 更新 ARP 缓存（有过期时间）

**跨子网情况**：

- 跨子网时目的 IP 在不同网段，发送方将帧目的 MAC 设为**默认网关的 MAC**
- 路由器收到后查路由表，在下一跳接口重新封装帧

---

## 七、以太网交换机

### 自学习机制

1. 交换机维护 **MAC 地址表（CAM 表）**：{MAC地址, 端口号, 时间戳}
2. 收到帧时，**记录源MAC**及对应端口
3. 查找**目的MAC**：
   - 找到 → 从对应端口转发（单播）
   - 未找到 → **泛洪**（从所有其他端口转发）
4. MAC 地址表项有老化时间（默认300秒），超时自动删除

### 广播域 vs 冲突域

| 设备 | 冲突域 | 广播域 |
|------|--------|--------|
| **集线器（Hub）** | 1个（所有端口共享） | 1个 |
| **交换机（Switch）** | 每端口1个（隔离冲突） | 1个（广播仍转发给所有端口） |
| **路由器（Router）** | 每端口1个 | 每端口1个（隔离广播） |

> 交换机隔离冲突域，路由器隔离广播域。VLAN 可以让交换机也隔离广播域。

### 三层交换机 vs 路由器

| 对比 | 三层交换机 | 路由器 |
|------|-----------|--------|
| 转发依据 | MAC表（二层）+ 路由表（三层） | 路由表（三层） |
| 转发速度 | 快（硬件ASIC） | 相对慢（软件路由） |
| 接口类型 | 以太网口为主 | 多种接口（Serial/ATM等） |
| 适用场景 | 园区网VLAN间路由 | 广域网互联、复杂路由 |

---

## 八、高频错误（5条）

**错误1**：GBN 和 SR 窗口大小混淆

- GBN 发送窗口 $\leq 2^n - 1$，SR 发送/接收窗口各 $\leq 2^{n-1}$
- 原因：SR 中若窗口 > $2^{n-1}$，接收方无法区分新帧和重传帧

**错误2**：以太网最小帧长忘记是 64 字节

- 数据字段最小 46 字节（不足46字节需填充），加上头尾共 64 字节

**错误3**：ARP 跨子网时认为向目标IP广播ARP

- 错：ARP广播到目标IP所在子网
- 正：ARP是本地广播（只在本子网），跨网段需路由器转发，目的MAC填网关MAC

**错误4**：交换机能隔离广播域

- 错：交换机可以隔离广播域
- 正：交换机**不能**隔离广播域（广播帧仍泛洪到所有端口），需要路由器或 VLAN

**错误5**：CRC 校验通过代表数据一定正确

- 错：CRC检验通过则数据正确
- 正：CRC 只能**检测**错误，极小概率漏检（若错误模式恰好被除数整除）；且CRC无法纠错

---

## 公式快查

| 协议 | 发送窗口上限 | 接收窗口 | 序号位 n 与窗口关系 |
|------|-------------|----------|---------------------|
| 停等 | 1 | 1 | — |
| GBN | $2^n - 1$ | 1 | 发送窗口 $\leq 2^n-1$ |
| SR | $2^{n-1}$ | $2^{n-1}$ | 发送窗口 = 接收窗口 $\leq 2^{n-1}$ |

$$\text{信道利用率（停等）} = \frac{T_f}{T_f + RTT + T_a}$$

$$\text{最小帧长} = 2\tau \times \text{速率（bps）}$$

---

## 相关链接

- [[02-科目/专业课/知识点/技术/计算机网络/00-网络MOC|00-网络MOC]]
- [[02-科目/专业课/知识点/技术/计算机网络/01-物理层|01-物理层]]（物理层信号基础）
- [[02-科目/专业课/知识点/技术/计算机网络/03-网络层|03-网络层]]（ARP由网络层触发，IP地址在网络层使用）
