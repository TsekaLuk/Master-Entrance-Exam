---
title: 内存管理
subject: 专业课843
chapter: 操作系统
status: 未开始
created: 2026-02-27
tags: [知识点, 843, 操作系统, 内存]
---

# 内存管理 ⭐⭐⭐

---

## 内存管理目标

| 目标 | 说明 |
|------|------|
| 地址隔离 | 各进程有独立地址空间，互不干扰 |
| 内存保护 | 防止进程越界访问 |
| 内存共享 | 多进程可共享代码段（如动态库）|
| 内存扩充 | 虚拟内存让进程地址空间超过物理内存 |

---

## 地址类型

| 类型 | 含义 |
|------|------|
| 逻辑地址（虚拟地址）| 程序使用的地址，从0开始 |
| 物理地址 | 内存条上的真实地址 |
| 地址映射 | 逻辑地址 → 物理地址（由MMU完成）|

---

## 连续内存分配

### 分区方式

| 方式 | 说明 | 问题 |
|------|------|------|
| 固定分区 | 将内存划分为固定大小的区域 | **内部碎片**（分区内浪费）|
| 动态分区 | 按需分配，大小可变 | **外部碎片**（空闲块分散）|

### 动态分区分配算法

| 算法 | 策略 | 特点 |
|------|------|------|
| 首次适应 (First Fit) | 找第一个足够大的空闲块 | 速度快，低地址碎片多 |
| 最佳适应 (Best Fit) | 找最小的足够大空闲块 | 碎片最小，但产生大量小碎片 |
| 最坏适应 (Worst Fit) | 找最大的空闲块 | 大块用完快，不实用 |

---

## 分页存储管理

### 基本概念

| 概念 | 说明 |
|------|------|
| 页（Page） | 逻辑地址划分的固定大小块 |
| 页框（Frame）| 物理内存划分的固定大小块，大小=页大小 |
| 页表 | 记录页→页框映射关系的数据结构 |

### 地址转换

```
逻辑地址 = 页号(p) + 页内偏移(d)

物理地址 = 页表[p] × 页大小 + d
```

**例题：** 页大小=4KB，逻辑地址=5000
- 页号 p = 5000 ÷ 4096 = 1（第2页，下标从0）
- 偏移 d = 5000 mod 4096 = 904
- 若页表[1]=3（页框号3），物理地址 = 3×4096 + 904 = **13192**

### 分页 vs 分段

| 维度 | 分页 | 分段 |
|------|------|------|
| 划分依据 | 固定大小（物理）| 逻辑功能（代码段/数据段）|
| 碎片类型 | 内部碎片（最后一页）| 外部碎片 |
| 地址结构 | 页号+偏移 | 段号+偏移 |
| 用户感知 | 透明 | 可见（程序员可指定段）|

**段页式**：先分段，每段再分页——结合两者优点

---

## 虚拟内存

### 基本思想

程序不必全部载入内存，**按需调页**（Demand Paging）：
- 访问的页不在内存 → **缺页中断** → 从磁盘调入
- 内存满 → 选择一页换出（页面置换）

### 页面置换算法

| 算法 | 策略 | 说明 |
|------|------|------|
| OPT（最优）| 淘汰未来最久不用的页 | 理论最优，**无法实现**（需预知未来）|
| FIFO | 淘汰最早进入内存的页 | 简单，可能**Belady异常** |
| LRU | 淘汰最近最久未使用的页 | 接近最优，**实现复杂**（需硬件支持）|
| Clock（近似LRU）| 循环扫描，淘汰访问位=0的页 | 实用折中方案 |

### Belady 异常

> **FIFO 算法**：增加页框数反而导致缺页次数增加的反常现象
> LRU 和 OPT **不会**出现 Belady 异常

### 计算例题框架

```
给定：页框数=3，访问序列：1 2 3 4 1 2 5 1 2 3 4 5

逐步模拟：
  1: [1]         缺页
  2: [1,2]       缺页
  3: [1,2,3]     缺页
  4: [4,2,3]     缺页（FIFO淘汰1，LRU淘汰1）
  ...

统计缺页率 = 缺页次数 / 总访问次数
```

---

## 易错点

| 错误 | 正确 |
|------|------|
| 分页有外部碎片 | 分页是**内部碎片**（最后一页没用满）|
| 分段有内部碎片 | 分段是**外部碎片**（段与段之间空隙）|
| LRU会Belady异常 | 只有**FIFO**会，LRU不会 |
| OPT可以实现 | OPT**理论最优但无法实现**（需预知未来）|

---

## 相关链接

- [[02-科目/专业课/知识点/技术/操作系统/01-操作系统基础|操作系统基础（总览）]]
- [[02-科目/专业课/知识点/技术/操作系统/02-进程管理|进程管理]]
- [[02-科目/专业课/知识点/技术/操作系统/04-死锁|死锁]]
- [[02-科目/专业课/错题/错题汇总|错题汇总]]
